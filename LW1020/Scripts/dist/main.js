define("extSchema",[],function(){var e=[{title:"Delete",width:45,template:"<input type='checkbox' class='chkbox' />",attributes:{"class":"align-center"}},{field:"status",title:"Billed/Unbilled",headerTemplate:"<div>Billed/</div><div>Unbilled</div>",width:55,headerAttributes:{"class":"wrap-header"},attributes:{"class":"align-center"}},{field:"id",width:50,format:"{0:00000}",hidden:!0},{field:"name",title:"Timekeeper Name",width:160,template:"<span title='${name}'>${name}</span>",headerAttributes:{"class":"wrap-header"}},{field:"lvl",width:30,hidden:!0},{field:"title",title:"Title",width:95,template:"<span title='${title}'>${title}</span>",headerAttributes:{"class":"wrap-header"}},{field:"loc",title:"Loc",width:50,attributes:{"class":"align-center"},headerAttributes:{"class":"wrap-header"}},{field:"dep",title:"Dept",width:50,attributes:{"class":"align-center"},headerAttributes:{"class":"wrap-header"}},{field:"hrsBill",title:"Hours Billed",headerTemplate:"<div>Hours</div><div>Billed</div>",width:60,format:"{0:n2}",headerAttributes:{"class":"wrap-header"},attributes:{"class":"align-right"},footerTemplate:"<div style='float: right'>#= kendo.toString(sum, 'n2') #</div>"},{field:"amtBill",title:"Amount Billed $",headerTemplate:"<div>Amount</div><div>Billed $</div>",format:"{0:n2}",headerAttributes:{"class":"wrap-header"},attributes:{"class":"align-right"},footerTemplate:"<div style='float: right'>#= kendo.toString(sum, 'n2') #</div>"},{field:"rateBlend",title:"Blended Rate",headerTemplate:"<div>Blended</div><div>Rate</div>",width:70,format:"{0:n2}",headerAttributes:{"class":"wrap-header"},attributes:{"class":"align-right"}},{field:"hrsProp",title:"Prop Hours",width:75,format:"{0:n2}",headerAttributes:{"class":"wrap-header"},attributes:{"class":"align-right"},footerTemplate:"<div style='float: right'>#= kendo.toString(sum, 'n2') #</div>",editor:l},{field:"rateProp",title:"Prop Rate",width:75,format:"{0:n2}",headerAttributes:{"class":"wrap-header"},attributes:{"class":"align-right"},editor:l},{field:"calcProp",title:"Prop Calc",format:"{0:n2}",headerAttributes:{"class":"wrap-header"},attributes:{"class":"align-right"},footerTemplate:"<div style='float: right'>#= kendo.toString(sum, 'n2') #</div>"},{field:"conv1",hidden:!0},{field:"conv2",hidden:!0},{field:"conv3",hidden:!0}],t=kendo.data.Model.define({id:"id",fields:{status:{},id:{},name:{},title:{},lvl:{type:"number",defaultValue:0},loc:{},dep:{},hrsBill:{type:"number",defaultValue:0},amtBill:{type:"number",defaultValue:0},rateBlend:{type:"number",defaultValue:0},hrsProp:{type:"number",defaultValue:0,validation:{min:0,required:!0}},rateProp:{type:"number",defaultValue:0,validation:{min:0,required:!0}},calcProp:{type:"number",defaultValue:0},conv1:{},conv2:{},conv3:{},rate1:{type:"number",defaultValue:0},calc1:{type:"number",defaultValue:0},rate2:{type:"number",defaultValue:0},calc2:{type:"number",defaultValue:0},rate3:{type:"number",defaultValue:0},calc3:{type:"number",defaultValue:0}}}),r={status:{},id:{},name:{},title:{},lvl:{type:"number",defaultValue:0},loc:{},dep:{},hrsBill:{type:"number",defaultValue:0},amtBill:{type:"number",defaultValue:0},rateBlend:{type:"number",defaultValue:0},hrsProp:{type:"number",defaultValue:0,validation:{min:0,required:!0}},rateProp:{type:"number",defaultValue:0,validation:{min:0,required:!0}},calcProp:{type:"number",defaultValue:0},conv1:{},conv2:{},conv3:{},rate1:{type:"number",defaultValue:0},calc1:{type:"number",defaultValue:0},rate2:{type:"number",defaultValue:0},calc2:{type:"number",defaultValue:0},rate3:{type:"number",defaultValue:0},calc3:{type:"number",defaultValue:0}},a=[{field:"hrsBill",aggregate:"sum"},{field:"amtBill",aggregate:"sum"},{field:"hrsProp",aggregate:"sum"},{field:"calcProp",aggregate:"sum"},{field:"calc1",aggregate:"sum"},{field:"calc2",aggregate:"sum"},{field:"calc3",aggregate:"sum"}],i=new kendo.data.DataSource({schema:{model:t},aggregate:a}),l=function(e,t){$('<input data-text-field="'+t.field+'" data-value-field="'+t.field+'" data-bind="value:'+t.field+'" data-format="'+t.format+'"/>').appendTo(e).kendoNumericTextBox({spinners:!1})};return{cols:e,model:t,flds:r,aggrs:a,ds:i,editNoSpinners:l}}),define("rateService",[],function(){var e=function(e,t,r,a){this.id=e,this.lvl=t,this.code=r,this.curr=a},t=function(e){var t=$.Deferred(),a=$.map(e,function(e){return r.apply(this,e)});return $.when.apply($,a).then(function(){var e=[];$.each(arguments,function(t,r){e.push(r)}),t.resolve(e)},function(e){t.reject(e)}),t.promise()},r=function(){var e=$.Deferred(),t=$.map(arguments,function(e){return a(e)});return $.when.apply($,t).then(function(t,r,a){e.resolve([].concat(t).concat(r).concat(a))},function(t){e.reject(t)}),e.promise()},a=function(){var e="N",t=0,r=$.Deferred(),a=Array.prototype.slice.call(arguments)[0];return void 0!==a.code?a.code>50?i(a.code,a.curr).then(function(i){if("[]"!==JSON.stringify(i)){var o=i[0]["rlev"+a.lvl.pad()]||0;o>0?(t=o,r.resolve({id:a.id,rate:t,conv:e})):l(a.id,a.curr).then(function(i){"[]"!==JSON.stringify(i)&&(e="Y",t=i[0].tkrtcur!==a.curr?i[0].cnvrt01||0:i[0].tkrt01||0),r.resolve({id:a.id,rate:t,conv:e})},function(e,t,i){toastr.error("getTimeRate: "+a.id+", "+a.curr,i),r.reject(i+"; getTimeRate: "+a.id+", "+a.code+", "+a.curr)})}else r.resolve({id:a.id,rate:t,conv:e})},function(e,t,i){toastr.error("getRate: "+a.code+", "+a.curr,i),r.reject(i+"; getRate: "+a.id+", "+a.code+", "+a.curr)}):l(a.id,a.curr).then(function(i){"[]"!==JSON.stringify(i)&&(i[0].tkrtcur!==a.curr?(e="Y",t=i[0].cnvrt01||0):t=(i[0]["tkrt"+a.code.pad()]||0)>0?i[0]["tkrt"+a.code.pad()]||0:i[0].tkrt01||0),r.resolve({id:a.id,rate:t,conv:e})},function(e,t,i){toastr.error("getTimeRate: "+a.id+", "+a.curr,i),r.reject(i+"; getTimeRate: "+a.id+", "+a.curr)}):r.resolve({id:a.id,rate:t,conv:e}),r.promise()},i=function(e,t){return $.get($.url("api/Modeler/GetRateList"),{code:e,curr:t},null,"jsonData")},l=function(e,t){return $.get($.url("api/Modeler/GetTimeRateList"),{id:e,curr:t},null,"jsonData")};return Number.prototype.pad=function(e){for(var t=String(this);t.length<(e||2);)t="0"+t;return t},$.postJSON=function(e,t){var r={url:e,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8"};return void 0!==t&&(r.data=JSON.stringify(t)),$.ajax(r)},{parm:e,getModelRate:a,getTkRates:r,getAllRates:t}}),define("utils",[],function(){function e(e){return _.reduce(e,function(e,t){return e+parseFloat(t)},0)}var t=function(e,t){for(var r,a=moment(e),i=o(1/t,4),l=0,d=[],s=0;t>s;s++)s===t-1&&(i=o(1-l,4)),r=moment(a).add(s,"months").endOf("month").format("MM/DD/YYYY"),d.push(new n(r,i)),l+=i;return d},r=function(e,t){for(var r,a,i,l,d=moment(e),s=moment(d).add(t-1,"months"),c=(d.diff(moment(),"years"),s.get("years")-d.get("years")+1),u=0,p=[],h=0;c>h;h++)a=moment(new Date(d.get("years")+h,11)),r=0===h?d:moment(new Date(d.get("years")+h,0)),i=a.get("months")-r.get("months")+1,l=o(i/t,4),h===c-1&&(l=o(1-u,4)),p.push(new n(d.get("years")+h,l)),u+=l;return p},a=function(e,t,r){return e*Math.pow(1+t,r)},i=function(e,t,r,a){return e*Math.pow(1+t,r)*Math.pow(1+a*t,a)},l=function(t,r){for(var a,l,o=(new Date).getFullYear(),n=new Date(this.day).getFullYear(),d=this.incr/100,s=n-o,c=0;c<this.mnths;c++)a=new Date(this.pctDist[c].dte).getFullYear(),l=a-n,this.pctDist[c].yr=new Date(this.pctDist[c].dte).getFullYear(),this.pctDist[c].rate=i(t,d,s,l),this.pctDist[c].wthrs=this.pctDist[c].pct*r,this.pctDist[c].wtrate=this.pctDist[c].pct*this.pctDist[c].rate,this.pctDist[c].wtamnt=this.pctDist[c].wthrs*this.pctDist[c].rate;for(var u=_.chain(this.pctDist).groupBy("yr").map(function(t,r){return _.chain(t).groupBy("rate").map(function(t,a){return{yr:r,rate:a,wthrs:e(_.pluck(t,"wthrs")),wtamnt:e(_.pluck(t,"wtamnt"))}}).value()}).value(),p=_.reduce(_.pluck(this.pctDist,"wtrate"),function(e,t){return e+t}),h=_.reduce(_.pluck(this.pctDist,"wtamnt"),function(e,t){return e+t}),f=new Array,c=0;c<u.length;c++)f.push({year:u[c][0].yr,rate:u[c][0].rate,calc:u[c][0].wtamnt});return f.push({year:9999,rate:p,calc:h}),f},o=function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)},n=function(e,t){this.dte=e,this.pct=t};return{mnthAlloc:t,yrAlloc:r,fvCalc:a,fvMthCalc:i,pctMthDist:l,pctItem:n,round:o}}),globalStore={},require(["extSchema","rateService","utils"],function(e,t,r){function a(e,t){this.text=e,this.value=t}function i(){$.ajax({url:$.url("api/Modeler/GetRates"),dataType:"jsonData",success:function(e){if("[]"!=JSON.stringify(e)){var t=-123,r=[];e.forEach(function(e){e.rtRateGroup!=t&&(r.push(new a(e.rtRateGroupDesc.trim(),e.rtRateGroup)),t=e.rtRateGroup),r.push(new a(e.rtDesc.trim(),e.rtCurr.trim()+"|"+e.rtCode+"|"+e.rtCurrSymbol.trim()+"|"+e.rtDesc.trim()))}),v=$("#ddlModel1").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:r,template:kendo.template($("#tmplRate").html()),optionLabel:"Select rate model 1",select:D}).data("kendoDropDownList"),v.list.width(275),g=$("#ddlModel2").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:r,template:kendo.template($("#tmplRate").html()),optionLabel:"Select rate model 2",select:D}).data("kendoDropDownList"),g.list.width(275),b=$("#ddlModel3").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:r,template:kendo.template($("#tmplRate").html()),optionLabel:"Select rate model 3",select:D}).data("kendoDropDownList"),b.list.width(275),s(),d(!1,!1)}},error:function(e,t,r){toastr.error("GetRates",r)},complete:function(){}})}function l(e,t,r,a,i,l){return globalStore.per==e&&globalStore.beg==t&&globalStore.end==r&&globalStore.bil==a&&globalStore.unb==i&&0!=l}function o(e,t,r,a,i,l){globalStore.per=e,globalStore.beg=t,globalStore.end=r,globalStore.bil=a,globalStore.unb=i,globalStore.tot=l}function n(e){e?($("#divPeriod").prop("disabled",!e),$("#chkBilled").prop("checked",e)):($("#divPeriod").prop("disabled",!e),$("input:radio[name=rbPeriod][value=Year]").prop("checked",!e),f.value(null),m.value(null),f.enable(e),m.enable(e),$("#chkBilled").prop("checked",e),$("#chkUnbilled").prop("checked",e))}function d(e,t){v.enable(e),g.enable(e),b.enable(e),$("#btnPull").prop("disabled",!t)}function s(){v.select(0),g.select(0),b.select(0)}function c(e){$("#btnDel").prop("disabled",e),$("#btnAdd").prop("disabled",e),$("#btnPrj").prop("disabled",e),$("#btnExl").prop("disabled",e)}var u={},p=function(){var e=this.value(),t=m.value();null!=t&&(moment(t).diff(e,"months",!0)<0&&toastr.error("From date must be before To date"),moment(t).diff(e,"months",!0)>36&&toastr.error("Maximum period range is 36 months"))},h=function(){var e=this.value(),t=f.value();null!=t&&(moment(e).diff(t,"months",!0)<0&&toastr.error("To date must be after From date"),moment(e).diff(t,"months",!0)>36&&toastr.error("Maximum period range is 36 months"))},f=$("#fromDate").kendoDatePicker({depth:"year",start:"year",format:"MMyy",parseFormats:["MMyy"],min:new Date(1980,11,1),change:p}).data("kendoDatePicker"),m=$("#toDate").kendoDatePicker({depth:"year",start:"year",format:"MMyy",parseFormats:["MMyy"],min:new Date(1980,11,1),change:h}).data("kendoDatePicker");f.enable(!1),m.enable(!1),$("#spnFrom, #spnTo").kendoValidator({rules:{valid:function(e){var t=$(e).val().trim(),r=moment(t,["MMYY"],!0).isValid();return""==t||r?!0:!1}},messages:{valid:"Invalid date"}});var v=$("#ddlModel1").kendoDropDownList({dataSource:["Select rate model 1"]}).getKendoDropDownList(),g=$("#ddlModel2").kendoDropDownList({dataSource:["Select rate model 2"]}).getKendoDropDownList(),b=$("#ddlModel3").kendoDropDownList({dataSource:["Select rate model 3"]}).getKendoDropDownList();v.enable(!1),g.enable(!1),b.enable(!1),i();var k=$("#grdTk").kendoGrid({autoBind:!1,columns:e.cols,dataSource:e.ds,editable:!0,resizable:!0}).data("kendoGrid");$("#txtClient").keypress(function(e){13==e.which&&$("#btnSearch").trigger("click")}),$('input[name="rbType"]').click(function(){"Matter"===$(this).val()?($("#chkSound").prop("disabled",!0),$("#txtClient").prop("disabled",!0).css("background-color","#eceaea"),$("#btnSearch").text("Continue")):($("#chkSound").prop("disabled",!1),$("#txtClient").prop("disabled",!1).css("background-color","#FFFFFF"),$("#btnSearch").text("Search"))}),$('input[name="rbPeriod"]').click(function(){$("#divPeriod").is(":enabled")&&("Year"===$(this).val()?(f.value(null),m.value(null),f.enable(!1),m.enable(!1),$("#fromDate").siblings("span.k-tooltip-validation").hide(),$("#toDate").siblings("span.k-tooltip-validation").hide()):(f.enable(!0),m.enable(!0)))}),$("#btnSearch").click(function(){var t=$("#divClient").height();$("#divClient").text("").height(t),$("#divMatter").text("").height(t),$("#divStart").text("").height(t),$("#divDuration").text("").height(t),$("#divCurrency").text("").height(t),$("#divGroup").text("").height(t),k.destroy(),k=$("#grdTk").empty().kendoGrid({autoBind:!1,columns:e.cols,dataSource:e.ds,editable:!0,resizable:!0}).data("kendoGrid"),k.dataSource.data([]),$("#btnPull").text("Pull Roster"),r.pctDist=void 0,r.yrs=void 0,r.day=void 0,r.mnths=void 0,r.incr=void 0,"Client"===$("[name=rbType]:checked").val()?y():w()}),$("#btnPull").on("click",function(){kendo.ui.progress($("#divTk"),!0);var e=$("#ddlModel1").getKendoDropDownList().value().split("|"),t=$("#ddlModel2").getKendoDropDownList().value().split("|"),r=$("#ddlModel3").getKendoDropDownList().value().split("|"),a=$("input:radio[name=rbPeriod]:checked").val(),i=kendo.toString(f.value(),"MMyy"),o=kendo.toString(m.value(),"MMyy"),n=$("#chkBilled").is(":checked"),d=$("#chkUnbilled").is(":checked"),s=k.dataSource.total();u.curr1=e[0],u.code1=parseInt(e[1])||void 0,u.currSymbol1=e[2],u.desc1=e[3],u.curr2=t[0],u.code2=parseInt(t[1])||void 0,u.currSymbol2=t[2],u.desc2=t[3],u.curr3=r[0],u.code3=parseInt(r[1])||void 0,u.currSymbol3=r[2],u.desc3=r[3];var c=k.dataSource.data().some(function(e){return""===e.status});"Period"===a?P(i,o).then(function(e){switch(e){case 0:c||l(a,i,o,n,d,s)?x():M();break;case 1:toastr.error("Invalid Ending period, please re-enter."),kendo.ui.progress($("#divTk"),!1);break;case 2:toastr.error("Invalid Beginning period, please re-enter."),kendo.ui.progress($("#divTk"),!1);break;case 3:default:toastr.error("Period needs to be within 3 years, please re-enter."),kendo.ui.progress($("#divTk"),!1)}},function(e){toastr.error("checkPeriod: "+e.statusText),kendo.ui.progress($("#divTk"),!1)}):c||l(a,i,o,n,d,s)?x():M()}),$("#btnDel").on("click",function(){var e=k.dataSource.data(),t=e.length;if(0==$("#grdTk").find("input:checked").length)toastr.warning("No timekeepers selected");else for(;t--;)e[t].dirty&&k.dataSource.remove(e[t])}),$("#btnAdd").on("click",function(){$("#wincontainer").append("<div id='winAdd'></div>"),$("#winAdd").kendoWindow({animation:{open:{effects:"slideIn:down fadeIn",duration:750},close:{effects:"slideIn:down fadeOut",reverse:!0,duration:500}},title:"Add a timekeeper",visible:!1,width:775,height:365,draggable:!0,resizable:!1,content:{url:$.url("Pages/AddTks")},modal:!0,open:function(){kendo.ui.progress($("#winAdd"),!0)},close:function(e){if(!e.userTriggered){kendo.ui.progress($("#winAdd"),!0);var t=$("#grdPrjHrs").data("kendoGrid").dataSource,r=$("#grdTk").data("kendoGrid").dataSource,a=t.data(),i=r.data().toJSON(),l=[];a.forEach(function(e){for(var t=1;t<=e.qtyEmp;t++)l.push({status:"",id:e.tkid,name:e.name,lvl:e.level,title:e.title,loc:e.loc,dep:e.dept,hrsBill:0,amtBill:0,rateBlend:0,hrsProp:e.totHrs,rateProp:0,calcProp:0,rate1:0,rate2:0,rate3:0,calc1:0,calc2:0,calc3:0})}),r.data(_.union(i,l)),r.total()>0&&(d(!0,!0),c(!1),$("#btnPull").text(" ReCalc "),$("#btnPull").trigger("click"))}},deactivate:function(){this.destroy()}}).data("kendoWindow").center().open()}),$("#btnPrj").on("click",function(){$("#wincontainer").append("<div id='winPrj'></div>"),$("#winPrj").kendoWindow({animation:{open:{effects:"slideIn:down fadeIn",duration:750},close:{effects:"slideIn:down fadeOut",reverse:!0,duration:500}},title:"Multi-Year Projection",visible:!1,width:550,height:300,draggable:!0,resizable:!1,content:{url:$.url("Pages/MultiYrProj")},modal:!0,close:function(e){e.userTriggered||$("#btnPull").trigger("click")},deactivate:function(){this.destroy()}}).data("kendoWindow").center().open()}),$("#btnExl").on("click",function(){if(k.dataSource.total()){kendo.ui.progress($("#divMain"),!0);var e=[];$.each(k.columns,function(t,r){void 0===r.field||void 0!==r.hidden&&r.hidden||e.push({field:r.field,title:r.title})});var t=k.dataSource.at(0);$.map(Object.keys(t),function(e){"lvl"!=e&&$.isInt(t[e])&&(t[e]=t[e]+1e-10)}),$.post($.url("Pages/GenerateExcel"),{colsDef:JSON.stringify(e),gridData:JSON.stringify(k.dataSource.data()),client:$("#divClient").text(),matter:$("#divMatter").text(),currency:$("#divCurrency").text(),rateGrp:$("#divGroup").text(),start:$("#divStart").text(),duration:$("#divDuration").text()}).done(function(e){window.location=$.url("Pages/DownloadExcel")+"?fName="+e.fileName}).fail(function(e,t,r){toastr.error("GenerateExcel: "+r)}).always(function(){kendo.ui.progress($("#divMain"),!1)}),$.post($.url("/Pages/LogUserInfo"))}else toastr.info("No data to export")});var y=function(){var e=$("#txtClient").val();$.isNumeric(e)?(globalStore.cliNum=e,globalStore.cliName=""):(globalStore.cliNum="",globalStore.cliName=e),globalStore.cliSndx=$("#chkSound").is(":checked")?1:0,$("#wincontainer").append("<div id='winCli'></div>"),$("#winCli").kendoWindow({animation:{open:{effects:"fadeIn",duration:750},close:{effects:"fade:out"}},title:"Expand Client & Click On Matter",visible:!1,width:400,height:350,draggable:!0,resizable:!1,content:{url:$.url("Pages/PopUpClients")},modal:!0,close:function(e){s(),c(!0),e.userTriggered?d(!1,!1):(n(!0),d(!0,!0),$("#btnAdd").prop("disabled",!1))},deactivate:function(){this.destroy()}}).data("kendoWindow").center().open()},w=function(){$("#wincontainer").append("<div id='winMat'></div>"),$("#winMat").kendoWindow({animation:{open:{effects:"fade:in",duration:750},close:{effects:"fade:out"}},title:"Type in new Matter Name and Currency:",visible:!1,width:290,height:100,draggable:!0,resizable:!1,content:{url:$.url("Pages/PopUpMatter")},modal:!0,open:function(){kendo.ui.progress($("#winMat"),!0)},close:function(e){s(),c(!0),e.userTriggered?d(!1,!1):(n(!1),d(!0,!1),$("#btnAdd").prop("disabled",!1),$("#divMatter").text("Matter:  "+$("#txtName").val()),$("#divCurrency").text("Matter's Currency:  "+$("#ddlCurr").data("kendoDropDownList").value()))},deactivate:function(){this.destroy()}}).data("kendoWindow").center().open()},S=function(){var e=this.checked,t=$(this).closest("tr"),r=k.dataItem(t);e?(t.addClass("k-state-selected"),r.dirty=!0):(t.removeClass("k-state-selected"),r.dirty=!1)},P=function(e,t){return $.get($.url("api/Modeler/CheckPeriod"),{from:e,to:t})},D=function(e){var t=this.dataItem(e.item.index());"number"==typeof t.value&&e.preventDefault()},M=function(){var e=globalStore.matNum.split("-").shift(),r=globalStore.matNum,a=kendo.toString(f.value(),"MMyy")||"",i=kendo.toString(m.value(),"MMyy")||"",l="Year"===$("input:radio[name=rbPeriod]:checked").val()?"Y":"N",o=$("#chkBilled").is(":checked")?"1":"0",n=$("#chkUnbilled").is(":checked")?"1":"0";$.get($.url("api/Modeler/GetTks"),{client:e,matter:r,begper:a,endper:i,History:l,Billed:o,Unbilled:n},null,"jsonData").done(function(e){if("[]"!==JSON.stringify(e)){globalStore.roster=e;var r=[];$.each(e,function(e,a){var i=a.ttk,l=a.tilevel,o=[];o.push(new t.parm(i,l,u.code1,u.curr1),new t.parm(i,l,u.code2,u.curr2),new t.parm(i,l,u.code3,u.curr3)),r.push(o)}),t.getAllRates(r).then(function(e){T(e,!1)},function(e){toastr.error("getAllRates: "+e),kendo.ui.progress($("#divTk"),!1)})}else toastr.warning("No timekeeper roster available at this time"),k.dataSource.data([]),$("#grdTk").find(".k-grid-content tbody").empty().append('<tr class="kendo-data-row"><td colspan="12" style="text-align:center"><b>No timekeeper roster available at this time</b></td></tr>'),kendo.ui.progress($("#divTk"),!1);$("#btnPull").prop("disabled",!1),$("#btnPull").text(" ReCalc ")}).fail(function(e,t,r){$("#btnPull").prop("disabled",!1),toastr.error("GetTks: "+r),kendo.ui.progress($("#divTk"),!1)}).always(function(){})},x=function(){var e=$("#grdTk").data("kendoGrid"),r=e.dataSource.data(),a=[],i=[];$.each(r,function(e,r){var l=r.id,o=r.lvl,n=[];n.push(new t.parm(l,o,u.code1,u.curr1),new t.parm(l,o,u.code2,u.curr2),new t.parm(l,o,u.code3,u.curr3)),a.push(n),i.push({tbillstatus:r.status,ttk:r.id,tkname:r.name,tilevel:r.lvl,tktitle:r.title,loaddr6:r.loc,label5:r.dep,tworkhrs:r.hrsProp,tbilldol:r.amtBill,rateProp:r.rateProp,calcProp:r.calcProp})}),globalStore.roster=i,t.getAllRates(a).then(function(e){T(e,!0)},function(e){toastr.error("getAllRates: "+e),kendo.ui.progress($("#divTk"),!1)})},T=function(t,a){var i,l,o,n=JSON.parse(JSON.stringify(e.flds)),d=JSON.parse(JSON.stringify(e.cols)),s=JSON.parse(JSON.stringify(e.aggrs));d[11].editor=e.editNoSpinners,d[12].editor=e.editNoSpinners;for(var p=1;3>=p;p++){if(void 0!==u["code"+p]?(l=" "+u["desc"+p],o=u["currSymbol"+p]):(l="",o=p),"undefined"!=typeof r.pctDist){i=r.yrs;for(var h=1;i>=h;h++)n["rate"+p+"Yr"+h]={type:"number",defaultValue:0},n["calc"+p+"Yr"+h]={type:"number",defaultValue:0},d.push({field:"rate"+p+"Yr"+h,title:"Proj Year "+h+l+" Rate "+o,format:"{0:n2}",headerAttributes:{"class":"wrap-header"},attributes:{"class":"align-right"}}),d.push({field:"calc"+p+"Yr"+h,title:"Proj Year "+h+l+" Calc "+o,format:"{0:n2}",headerAttributes:{"class":"wrap-header"},attributes:{"class":"align-right"},footerTemplate:"<div style='float: right'>#= kendo.toString(sum, 'n2') #</div>"}),s.push({field:"calc"+p+"Yr"+h,aggregate:"sum"})}d.push({field:"rate"+p,title:"Total Proj"+l+" Rate "+o,headerAttributes:{"class":"wrap-header"},attributes:{"class":"align-right"},template:kendo.template($("#tmplConv"+p).html())}),d.push({field:"calc"+p,title:"Total Proj"+l+" Calc "+o,format:"{0:n2}",headerAttributes:{"class":"wrap-header"},attributes:{"class":"align-right"},footerTemplate:"<div style='float: right'>#= kendo.toString(sum, 'n2') #</div>"})}var f=[];$.each(globalStore.roster,function(e,l){if(!$("#chkUnbilled").is(":checked")&&"U"===l.tbillstatus||!$("#chkBilled").is(":checked")&&"B"===l.tbillstatus);else if(0===l.tworkhrs&&0===l.tbilldol&&""!==l.tbillstatus);else{var o=_.find(t,function(e){return e[0].id===l.ttk}),n={status:l.tbillstatus,id:l.ttk,name:l.tkname,lvl:l.tilevel,title:l.tktitle,loc:l.loaddr6,dep:l.label5,hrsBill:""===l.tbillstatus?0:l.tworkhrs,amtBill:l.tbilldol,rateBlend:0===l.tworkhrs?0:l.tbilldol/l.tworkhrs,hrsProp:l.tworkhrs,rateProp:a?l.rateProp:0,calcProp:a?l.calcProp:0,conv1:o[0].conv,conv2:o[1].conv,conv3:o[2].conv,rate1:o[0].rate,calc1:o[0].rate*l.tworkhrs,rate2:o[1].rate,calc2:o[1].rate*l.tworkhrs,rate3:o[2].rate,calc3:o[2].rate*l.tworkhrs};if(void 0!==r.pctDist){var d=r.pctDist;if(-1===d[0].dte.indexOf("/")){for(var s=r.incr/100,c=(new Date).getFullYear(),u=0,p=0,h=0,m=1;i>=m;m++)n["rate1Yr"+m]=r.fvCalc(n.rate1,s,d[m-1].dte-c),n["calc1Yr"+m]=r.round(n["rate1Yr"+m]*n.hrsProp*d[m-1].pct,2),u+=n["rate1Yr"+m]*d[m-1].pct,n["rate2Yr"+m]=r.fvCalc(n.rate2,s,d[m-1].dte-c),n["calc2Yr"+m]=r.round(n["rate2Yr"+m]*n.hrsProp*d[m-1].pct,2),p+=n["rate2Yr"+m]*d[m-1].pct,n["rate3Yr"+m]=r.fvCalc(n.rate3,s,d[m-1].dte-c),n["calc3Yr"+m]=r.round(n["rate3Yr"+m]*n.hrsProp*d[m-1].pct,2),h+=n["rate3Yr"+m]*d[m-1].pct;n.rate1=u,n.calc1=r.round(u*n.hrsProp,2),n.rate2=p,n.calc2=r.round(p*n.hrsProp,2),n.rate3=h,n.calc3=r.round(h*n.hrsProp,2)}else for(var v=r.pctMthDist(n.rate1,n.hrsProp),g=r.pctMthDist(n.rate2,n.hrsProp),b=r.pctMthDist(n.rate3,n.hrsProp),k=v.length,y=1;k>=y;y++)n["rate1Yr"+y]=parseFloat(v[y-1].rate).toFixed(2),n["calc1Yr"+y]=r.round(v[y-1].calc,2),n["rate2Yr"+y]=parseFloat(g[y-1].rate).toFixed(2),n["calc2Yr"+y]=r.round(g[y-1].calc,2),n["rate3Yr"+y]=parseFloat(b[y-1].rate).toFixed(2),n["calc3Yr"+y]=r.round(b[y-1].calc,2),y===k&&(n.rate1=v[y-1].rate,n.calc1=r.round(v[y-1].calc,2),n.rate2=g[y-1].rate,n.calc2=r.round(g[y-1].calc,2),n.rate3=b[y-1].rate,n.calc3=r.round(b[y-1].calc,2))}f.push(n)}}),k.destroy(),k=$("#grdTk").empty().kendoGrid({dataSource:{data:f,schema:{model:{id:"id",fields:n}},aggregate:s},columns:d,editable:{confirmation:!1},navigatable:!0,resizable:!0,pageable:{pageSize:10},edit:Y,save:B,dataBound:N}).data("kendoGrid"),0!=k.dataSource.total()&&c(!1),k.table.on("click",".chkbox",S)},Y=function(e){var t=k.columns[e.container.index()].field,r="hrsProp, rateProp";-1===r.indexOf(t)&&this.closeCell()},B=function(e){for(var t in e.values);if("rateProp"===t&&e.model.set("calcProp",e.model.hrsProp*e.values.rateProp),"hrsProp"===t&&(e.model.set("calcProp",e.values.hrsProp*e.model.rateProp),e.model.set("calc1",e.values.hrsProp*e.model.rate1),e.model.set("calc2",e.values.hrsProp*e.model.rate2),e.model.set("calc3",e.values.hrsProp*e.model.rate3),"undefined"!=typeof r.pctDist))for(var a=r.yrs,i=1;a>=i;i++)e.model.set("calc1Yr"+i,e.values.hrsProp*e.model["rate1Yr"+i]),e.model.set("calc2Yr"+i,e.values.hrsProp*e.model["rate2Yr"+i]),e.model.set("calc3Yr"+i,e.values.hrsProp*e.model["rate3Yr"+i]);this.refresh()},N=function(){var e=$("input:radio[name=rbPeriod]:checked").val(),t=kendo.toString(f.value(),"MMyy"),r=kendo.toString(m.value(),"MMyy"),a=$("#chkBilled").is(":checked"),i=$("#chkUnbilled").is(":checked"),l=this.dataSource.total();o(e,t,r,a,i,l),kendo.ui.progress($("#divTk"),!1)}}),define("main",function(){});
//# sourceMappingURL=main.js.map